#!/usr/bin/env perl
use 5.14.0;
use warnings;
use utf8::all;
use Anki::Corpus;

my $word = shift
    or die "usage: $0 word\n";

my $corpus = Anki::Corpus->new;
while (<STDIN>) {
    next unless /\S/;
    my ($japanese, $translation) = split '｜', $_;

    unless ($japanese && $translation) {
        warn "Oddly formatted progressive line: $_\n";
        next;
    }

    for ($japanese, $translation) {
        s/^\s+//;
        s/\s+$//;
    }

    my $id = $corpus->add_sentence(
        japanese    => $japanese,
        translation => $translation,
        source      => 'プログレッシブ英和・和英中辞典',
    );
    if ($id) {
        $corpus->add_note(
            sentence => $id,
            type     => '見出し語',
            value    => $word,
        );
    }
}
